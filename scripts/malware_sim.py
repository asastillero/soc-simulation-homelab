import os
import subprocess
import winreg
import time

# Simulate writing a suspicious registry key
def write_registry():
    key = winreg.HKEY_CURRENT_USER
    path = r"Software\Microsoft\Windows\CurrentVersion\Run"
    name = "FakeMalware"
    value = "cmd.exe /c calc.exe"  # Launch calculator on startup
    try:
        reg_key = winreg.OpenKey(key, path, 0, winreg.KEY_SET_VALUE)
        winreg.SetValueEx(reg_key, name, 0, winreg.REG_SZ, value)
        winreg.CloseKey(reg_key)
        print("[+] Registry key written.")
    except Exception as e:
        print(f"[-] Registry write failed: {e}")

# Simulate creating a scheduled task (persistence)
def create_task():
    try:
        subprocess.run([
            "schtasks", "/create", "/tn", "MalwareSimulator",
            "/tr", "calc.exe", "/sc", "minute", "/mo", "5"
        ], check=True)
        print("[+] Scheduled task created.")
    except subprocess.CalledProcessError as e:
        print(f"[-] Task creation failed: {e}")

# Simulate suspicious process execution
def run_payload():
    print("[*] Running payload...")
    subprocess.Popen("calc.exe")  # Calculator is harmless, but detectable

# Execute all steps
write_registry()
create_task()
run_payload()
time.sleep(2)
print("[*] Done.")
